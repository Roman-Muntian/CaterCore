{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "Оформлення замовлення" %}{% endblock %}

{% block extra_head %}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=places&callback=initAutocomplete" async defer></script>
    <script>
        function initAutocomplete() {
            // Ця функція спрацює, коли API завантажиться
            const input = document.getElementById('id_delivery_address');
            if (input) {
                const autocomplete = new google.maps.places.Autocomplete(input, {
                    types: ['address'],
                    componentRestrictions: {'country': ['pl', 'ua', 'de']} // Обмежуємо пошук країнами
                });
                // Можна додати слухача для автозаповнення інших полів, якщо потрібно
                // autocomplete.addListener('place_changed', () => { ... });
            } else {
                console.error("Елемент 'id_delivery_address' не знайдено для Google Autocomplete.");
            }
        }
    </script>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-8">{% trans "Оформлення замовлення" %}</h1>
    
    <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
        <div id="checkout-form-container" class="md:col-span-3 bg-white p-6 rounded-lg shadow-lg">
             {% include "orders/partials/checkout_form.html" %}
        </div>
        
        <aside class="md:col-span-2 bg-white p-6 rounded-lg shadow-lg h-fit">
            <h2 class="text-xl font-bold mb-4">{% trans "Ваше замовлення" %}</h2>
            <div id="order-summary" class="space-y-3 mb-4">
            {% for item in cart.items.all %}
                <div class="flex justify-between">
                    <span>{{ item.dish.name }} x {{ item.quantity }}</span>
                    <span class="font-medium">{{ item.total_price }} zł</span>
                </div>
            {% empty %}
                <p>{% trans "Ваш кошик порожній." %}</p>
            {% endfor %}
            </div>
            <hr class="my-4">
            <div class="flex justify-between text-xl font-bold">
                <span>{% trans "Всього" %}:</span>
                <span>{{ cart.total_price }} zł</span>
            </div>
        </aside>
    </div>
</div>
{% endblock %}